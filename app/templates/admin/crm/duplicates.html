{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Duplicate Leads</h2>
    <p>Potential duplicates found by email address.</p>

    {% if not duplicates %}
    <div class="alert alert-success">No duplicates found!</div>
    {% else %}

    {% for group in duplicates %}
    <div class="card mb-4">
        <div class="card-header">
            <strong>{{ group.email }}</strong> - {{ group.type }} ({{ group.count }} items)
        </div>
        <div class="card-body">
            <ul class="list-group">
                {% for item in group.records %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        {% if item.__tablename__ == 'appointment' %}
                        <span class="badge badge-info">Appt</span>
                        {% else %}
                        <span class="badge badge-warning">Contact</span>
                        {% endif %}
                        {{ item.first_name }} {{ item.last_name }} - {{ item.submitted_at if item.submitted_at else
                        item.created_at }}
                        <br>
                        <small class="text-muted">{{ item.notes or 'No notes' }}</small>
                    </div>
                    <div>
                        <span class="badge badge-secondary">{{ item.status }}</span>
                        <!-- Merge actions could go here -->
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endfor %}

    {% endif %}
</div>
{% endblock %}