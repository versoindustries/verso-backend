{% extends "base.html" %}

{% block title %}Support Queue{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2><i class="fas fa-headset me-2"></i>Support Queue</h2>
            <p class="text-muted mb-0">Manage customer support tickets</p>
        </div>
    </div>

    <!-- Stats Row -->
    <div class="row g-3 mb-4">
        <div class="col-md-2">
            <div class="card bg-info text-white">
                <div class="card-body text-center py-3">
                    <h3 class="mb-0">{{ stats.open }}</h3>
                    <small>Open</small>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card bg-primary text-white">
                <div class="card-body text-center py-3">
                    <h3 class="mb-0">{{ stats.in_progress }}</h3>
                    <small>In Progress</small>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card bg-warning text-dark">
                <div class="card-body text-center py-3">
                    <h3 class="mb-0">{{ stats.waiting }}</h3>
                    <small>Waiting</small>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card bg-success text-white">
                <div class="card-body text-center py-3">
                    <h3 class="mb-0">{{ stats.resolved }}</h3>
                    <small>Resolved</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body text-center py-3">
                    <h3 class="mb-0">{{ stats.total }}</h3>
                    <small>Total Tickets</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body py-2">
            <div class="d-flex gap-2 flex-wrap">
                <a href="{{ url_for('support.admin_queue', status='all') }}"
                    class="btn btn-sm {{ 'btn-primary' if status_filter == 'all' else 'btn-outline-primary' }}">All</a>
                <a href="{{ url_for('support.admin_queue', status='active') }}"
                    class="btn btn-sm {{ 'btn-primary' if status_filter == 'active' else 'btn-outline-primary' }}">Active</a>
                <a href="{{ url_for('support.admin_queue', status='open') }}"
                    class="btn btn-sm {{ 'btn-info' if status_filter == 'open' else 'btn-outline-info' }}">Open</a>
                <a href="{{ url_for('support.admin_queue', status='in_progress') }}"
                    class="btn btn-sm {{ 'btn-primary' if status_filter == 'in_progress' else 'btn-outline-primary' }}">In
                    Progress</a>
                <a href="{{ url_for('support.admin_queue', status='waiting') }}"
                    class="btn btn-sm {{ 'btn-warning' if status_filter == 'waiting' else 'btn-outline-warning' }}">Waiting</a>
                <a href="{{ url_for('support.admin_queue', status='resolved') }}"
                    class="btn btn-sm {{ 'btn-success' if status_filter == 'resolved' else 'btn-outline-success' }}">Resolved</a>
            </div>
        </div>
    </div>

    <!-- Tickets Table -->
    <div class="card">
        <div class="card-body p-0">
            <div data-react-component="AdminDataTable" data-react-props='{
                "columns": [
                    {"accessorKey": "ticket_number", "header": "Ticket #", "html": true, "sortable": true},
                    {"accessorKey": "subject", "header": "Subject", "sortable": true},
                    {"accessorKey": "customer", "header": "Customer", "sortable": true},
                    {"accessorKey": "priority", "header": "Priority", "html": true, "sortable": true},
                    {"accessorKey": "status", "header": "Status", "html": true, "sortable": true},
                    {"accessorKey": "assigned", "header": "Assigned To", "html": true},
                    {"accessorKey": "created", "header": "Created", "sortable": true}
                ],
                "data": {{ tickets_json | safe }},
                "idKey": "id",
                "emptyStateMessage": "No tickets match your filter."
            }'></div>
        </div>
    </div>
</div>
{% endblock %}