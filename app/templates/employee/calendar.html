{% extends "base.html" %}

{% block title %}My Calendar - {{ estimator.name if estimator else 'Staff' }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/employee-calendar.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-calendar-alt"></i> My Appointments</h2>
        {% if estimator %}
        <div>
            <a href="{{ url_for('calendar.ics_feed', estimator_id=estimator.id) }}"
                class="btn btn-sm btn-outline-secondary" title="Subscribe in external calendar">
                <i class="fas fa-rss"></i> ICS Feed
            </a>
        </div>
        {% endif %}
    </div>

    {% if not estimator %}
    <div class="alert alert-warning">
        <i class="fas fa-exclamation-triangle"></i>
        Your user account is not linked to an estimator profile. Please contact an administrator.
    </div>
    {% else %}

    <div data-react-component="EmployeeCalendar" data-react-props='{
             "eventsUrl": "{{ url_for(' employee.calendar_events') }}", "checkinUrlPattern"
        : "/employee/appointment/{id}/checkin" , "checkoutUrlPattern" : "/employee/appointment/{id}/checkout"
        , "notesUrlPattern" : "/employee/appointment/{id}/notes" , "rescheduleUrlPattern"
        : "/employee/appointment/{id}/reschedule" , "pendingReschedules" : {{ pending_reschedules_json | default('[]') |
        safe }}, "icsFeedUrl" : "{{ url_for('calendar.ics_feed', estimator_id=estimator.id) if estimator else '' }}" }'>
        <!-- Loading fallback -->
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading calendar...</span>
            </div>
            <p class="mt-2 text-muted">Loading calendar...</p>
        </div>
    </div>

    {% endif %}
</div>
{% endblock %}