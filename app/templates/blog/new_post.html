{% extends "base.html" %}

{% block title %}Create a New Blog Post{% endblock %}

{% block description %}Share your insights with the community. Create and publish your blog post.{% endblock %}

{% block additional_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/blog-post-editor.css') }}">
{% endblock %}

{% block head %}
<meta name="description" content="{{ description | e }}">
<meta property="og:title" content="{{ title | e }}">
<meta property="og:description" content="{{ description | e }}">
<meta property="og:image" content="{{ url_for('static', filename='images/logo.png') }}">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ title | e }}">
<meta name="twitter:description" content="{{ description | e }}">
<meta name="twitter:image" content="{{ url_for('static', filename='images/logo.png') }}">
<link rel="canonical" href="{{ request.url }}">
<meta name="robots" content="noindex, nofollow">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "{{ title | e }}",
  "description": "{{ description | e }}"
}
</script>
{% endblock %}

{% block content %}
<div class="container py-4">
  {# Flash messages #}
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  <div class="flash-messages mb-4">
    {% for category, message in messages %}
    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show">
      {{ message | e }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
  </div>
  {% endif %}
  {% endwith %}

  {# React BlogPostEditor Component #}
  <div data-react-component="BlogPostEditor" data-react-props='{
    "categories": {{ categories_json | safe if categories_json else "[]" }},
    "series": {{ series_json | safe if series_json else "[]" }},
    "csrfToken": "{{ form.csrf_token._value() }}",
    "apiEndpoint": "{{ url_for('blog.api_create_post') }}", "redirectUrl" : "{{ url_for('blog.manage_posts') }}" }'>
    {# Fallback for non-JS users #}
    <noscript>
      <section class="header-section">
        <div class="header-container">
          <h1 class="header-title">Create a New Blog Post</h1>
          <p class="header-subtitle">JavaScript is required for the blog post editor.</p>
          <a href="{{ url_for('blog.manage_posts') }}" class="btn btn-primary">Back to Manage Posts</a>
        </div>
      </section>
    </noscript>

    {# Loading state while React mounts #}
    <div class="editor-loading" id="editor-loading">
      <div class="editor-spinner"></div>
      <span>Loading editor...</span>
    </div>
  </div>
</div>

<script>
  // Hide loading spinner once React mounts
  document.addEventListener('DOMContentLoaded', function () {
    // Give React time to mount
    setTimeout(function () {
      var loading = document.getElementById('editor-loading');
      if (loading) {
        loading.style.display = 'none';
      }
    }, 500);
  });
</script>
{% endblock %}