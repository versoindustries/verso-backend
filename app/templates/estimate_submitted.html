{% extends "base.html" %}

{% block additional_css %}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/submission.css') }}">
{% endblock %}

{% block content %}
<div class="section-spacer"></div>
<div class="submission-success">
  <div class="alert alert-success" role="alert">
    <h4 class="alert-heading">Submission Successful!</h4>
    <p>Your estimate request has been submitted successfully. We will see you at the scheduled date.</p>
    <hr>
    <p class="mb-0">Thank you for choosing us. You will be redirected back shortly. You have 45 seconds to save the date to your calendar.</p>
    <p class="mt-3">Estimator: {{ estimator }}</p>
    <p class="mt-3">Location: <a href="https://www.google.com/maps/place/221+North+Plymouth+Ave,+New+Plymouth,+Idaho+83655" target="_blank">221 North Plymouth Ave, New Plymouth, Idaho 83655</a></p>
    <p class="mt-3">Date: {{ date }}</p>
    <p class="mt-3">Time: {{ time }}</p>  <!-- This will now display the formatted time -->
    <div class="small-spacer"></div>
    <p class="mt-3">Add to Calendar: 
        <a href="https://www.google.com/calendar/render?action=TEMPLATE&text=Appointment+with+{{ estimator }}&dates={{ date|replace('-', '') }}T{{ time|replace(':', '') }}00Z/{{ date|replace('-', '') }}T{{ (time|replace(':', '')|int + 100) }}00Z&details=Your+appointment+at+425+S+Whitley+Dr,+Fruitland,+ID+83619&location=425+S+Whitley+Dr,+Fruitland,+ID+83619" target="_blank" class="btn btn-calendar">Google Calendar</a>
        <a href="{{ url_for('main_routes.generate_ics', estimator=estimator, location='221 North Plymouth Ave, New Plymouth, ID 83655', date=date, time=time) }}" target="_blank" class="btn btn-calendar">iCalendar</a>
    </p>
    <div class="section-spacer"></div>
    <!-- This button can stay for manual redirection, in case automatic redirection doesn't work -->
    <a href="{{ url_for('main_routes.index') }}" class="btn btn-primary mt-3">Return Home</a>
  </div>
</div>
<script>
  // JavaScript for automatic redirection
  document.addEventListener('DOMContentLoaded', (event) => {
    setTimeout(function() {
      // Use the referrer if available, or fall back to the home page
      window.location.href = "{{ request.args.get('referrer', url_for('main_routes.index')) }}";
    }, 45000); // 45000 milliseconds = 45 seconds
  });
</script>
{% endblock %}
